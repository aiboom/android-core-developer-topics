# Android后台任务概述

## 后台执行任务的必要性

> 延伸：
>
> Android主线程的意义
>

看了上面的文章，你就会明白，一些需要耗时的操作本身是不能在主线程中操作的，否则会引起ANR。理论上，超过毫秒级的操作都应该使用后台任务。

### 后台任务的分类

针对不同的任务类型，应当选择合适的解决方案。下面说一下后台任务的类型：

* 即时性和延时性任务：即时性任务是用户操作后需要立即执行的任务，比如用户点击登录按钮后需要立即执行登录操作。延时性任务是不需要立即执行的任务，比如定期检查用户的登录状态。
* 保活任务和非保活任务：包活指的是保证App所在进程不被系统杀死。比如上述的执行的登录操作，在后台任务执行的过程中，是不允许App所在进程被杀死的。非保活任务的典型例子就是后台播放音乐，音乐App所在进程是可以被杀死的（前提是后台任务不在App进程中）。
* 是否可以由系统触发器触发：即任务是否可以由系统触发器触发执行。

针对上面的三种任务类型分类，下表给出了相应的解决方案：

![](res\how_to_choose_bt.png)

### 解决方案的说明

#### ThreadPools

操作只能在App处于前台状态下完成的任务，是要TheadPools。ThreadPools提供了一系列后台线程来执行任务，你也可以使用动态注册的广播接收器来监视系统状态和触发器。

#### 前台服务

前台服务的意义在于，它可以立即执行一个需要有结果的任务，并且系统不会杀死其App所在的进程。前台服务可以由通知栏的一个不可消失的通知显示。

#### WorkManager

当系统触发器被触发，WorkManager可被用来优雅地执行计划性的延时任务。

> WorkManager基于JobScheduler实现，如果API低于23，WorkManager需要依赖Firebase的JobDispatcher实现。否则WorkManager讲基于AlarmManager实现，而这种实现方法是最差的。
